

{% macro menu_item(url, text, class='') %}
    {% if url == request.path or (url != '/' and request.path.startswith(url)) %}
        {% set class = class + ' active' %}
    {% endif %}
    <li{% if class %} class="{{ class }}"{% endif %}>
        <a href="{{ url }}">{{ text|safe }}</a>
    </li>
{% endmacro %}


{% macro volume_image(year) %}
    {% set year = year|string %}
    {% set filename = 'images/v' + year + '.jpg' %}

    {% if not ('static/' + filename)|file_exists %}
        {% set filename = 'images/placeholder.jpg' %}
    {% endif %}

    <img src="{{ url_for('static', filename=filename) }}" class="img-responsive">
{% endmacro %}


{% macro volume_item(year, place, topic) %}
    {% set year = year|string %}

    <a href="{{ url_for('history', year=year) }}" class="thumbnail v{{ year }}">
        {{ volume_image(year) }}
        <div class="caption">
            <h3>
                {{ topic|split('Â·')|join('<small class="amp">&nbsp;&amp;</small><br>')|safe }}
                <small>{{ place }} {{ year }}</small>
            </h3>
        </div>
    </a>
{% endmacro %}


{% macro history_menu(texts) %}
    <div class="nav nav-history">
        <div class="row">
            {% for text in texts %}
                <div class="col-md-4">
                    {{ volume_item(
                        text.year,
                        text.place,
                        text.title
                    ) }}
                </div>
                {% if loop.index is divisibleby 3 %}<div class="clearfix"></div>{% endif %}
            {% endfor %}
        </div>
    </div>
{% endmacro %}


{% macro album_image(album) %}
    <img src="{{ url_for('image_proxy', url=album.image_url, resize='400x400') }}" class="img-responsive">
{% endmacro %}


{% macro album_gallery(albums) %}
    <div class="nav nav-albums">
        <div class="row">
            {% for album in albums %}
                <div class="col-md-4">
                    <a href="{{ album.url }}" class="thumbnail" target="_blank">
                        {{ album_image(album) }}
                        <div class="caption">
                            <h3>
                                {% if album.count == 1 %}
                                    1 fotka
                                {% else %}
                                    {{ album.count }} fotek
                                {% endif %}
                            </h3>
                        </div>
                    </a>
                    {% if loop.index is divisibleby 3 %}<div class="clearfix"></div>{% endif %}
                </div>
            {% endfor %}
        </div>
    </div>
{% endmacro %}


{% macro member_image(slug) %}
    {% set filename = 'images/' + slug + '.jpg' %}

    {% if not ('static/' + filename)|file_exists %}
        {% set filename = 'images/placeholder.jpg' %}
    {% endif %}
    <img src="{{ url_for('static', filename=filename) }}" class="img-responsive">
{% endmacro %}


{% macro member_item(slug, name, nickname=None, post=None) %}
    <a href="{{ url_for('team', slug=slug) }}" class="thumbnail {{ post|slugify }}">
        {{ member_image(slug) }}
        <div class="caption">
            <h3>
                {{ name }}
                {% if nickname %}
                    <small>{{ nickname }}</small>
                {% endif %}
                <small><strong>{{ post }}</strong></small>
            </h3>
        </div>
    </a>
{% endmacro %}


{% macro team_menu(texts) %}
    <div class="nav nav-team">
        <div class="row">
            <div class="col-md-4 col-md-offset-4">
                {{ member_item(
                    texts.0.slug,
                    texts.0.full_name,
                    texts.0.nickname,
                    texts.0.post
                ) }}
            </div>
            <div class="clearfix"></div>
            {% for text in texts[1:] %}
                <div class="col-md-4">
                    {{ member_item(
                        text.slug,
                        text.full_name,
                        text.nickname,
                        text.post
                    ) }}
                </div>
                {% if loop.index is divisibleby 3 %}<div class="clearfix"></div>{% endif %}
            {% endfor %}
        </div>
    </div>
{% endmacro %}
